
### scDGN - supervised adversarial alignment of single-cell RNA-seq data {#ch-5-6-4}

scDGN [110], or Single Cell Domain Generalization Network, is an domain adversarial network that aims to accurately assign cell types of single cells while performing batch removal (domain adaptation) at the same time. It benefits from the superior ability of domain adversarial learning to learn representations that are invariant to technical confounders. 

*Model.* scDGN takes the log-transformed, normalized expression as the input and has three main modules: i) an encoder (E_ϕ (x_n )) for dimension reduction of scRNA-Seq data, ii) cell-type classifier, C_(ϕ_C ) (E_ϕ (x_n )) with parameters ϕ_C, and iii) domain (batch) discriminator, D_(ϕ_D ) (E_ϕ (x_n )). The model has a Siamese design and the training takes a pair of cells (x_1,x_2 ), each from the same or different batches. The encoder network contains two hidden layers with 1146 and 100 neurons. C_(ϕ_C ) classifies the cell type and D_(ϕ_D ) predicts whether x_1 and x_2 are from the same batch or not. The overall loss is denoted by
	L(ϕ,ϕ_C,ϕ_D )=L_C (C_(ϕ_C ) (E_ϕ (x_1 )))-λL_D (D_(ϕ_D ) (E_ϕ (x_1 )),D_(ϕ_D ) (E_ϕ (x_2 )))	(46)
where L_C is the cross entropy loss,  L_D is a contrastive loss as described in [111]. Notice that (46) has an adversarial formulation and minimizing this loss maximizes the misclassification of cells from different batches, thus making them indistinguishable.  Similar to GAN training, scDGN is trained to iteratively solve: ϕ ̂_D=argmin_(ϕ_D ) L(ϕ ̂,ϕ ̂_C,ϕ_D ) and (ϕ ̂,ϕ ̂_C )=argmin_(ϕ,ϕ_C ) L(ϕ,ϕ_C,ϕ ̂_D ).

*Evaluation metrics.* Prediciton accuracy was used to evaluate the performance. 

*Results.* scDGN was tested for classifying cell types and aligning batches ranging in size from 10 to 39 cell types and from 4 to 155 batches. The performance was compared to a series of deep learning and traditional machine learning methods, including Lin et al. DNN [68], CaSTLe [112], MNN [28], scVI [13], and Seurat [9]. scDGN outperformed all other methods in the classification accuracy on a subset of scQuery datasets (0.29), PBMC (0.87), and 4 of the six Seurat pancreatic datasets (0.86-0.95). PCA visualization of the learned data representations demonstrated that scDGN overcame the batch differences and clearly separated cell clusters based on cell types, while other methods were vulnerable to batch effects. In summary, scDGN is a supervised adversarial alignment method to eliminate the batch effect of scRNA-Seq data and create cleaner representations of cell types.
